{"version":3,"sources":["components/MainText.js","components/SummaryPage.js","components/MainPage.js","App.js","serviceWorker.js","index.js","components/AnnotationButton.js","components/Annotation.js"],"names":["colors","MainText","props","handleImportFileAnnotations","e","a","preventDefault","reader","FileReader","onload","text","target","result","document","getElementById","value","readAsText","files","state","ANNOTATIONS","annotation_id","maxDepth","defaultColorInd","textPanes","isShowHelp","isShowImport","isShowImportAnnotations","isShowExportAnnotations","isShowSummary","isAutoEditMode","handleAutoAnnotate","bind","handleAnnotate","handleRerender","handleAppend","handleAppendEnter","handleClear","handleDeleteAnnotation","handleDefaultColor","onSetSidebarOpen","handleExample","handleShowImport","handleImportAppend","handleImportReplace","handleShowHelp","handleShowExportAnnotations","handleShowImportAnnotations","handleImportAnnotations","handleStartFileUpload","handleSummarizeAnnotations","handleEditMode","this","setState","ann","color","reloadTextPanes","index","i","length","annotation","splice","apply","concat","children","pane_list","modified_children","Array","isArray","updater","deleter","key","depth","getElementsByClassName","getSelection","toString","sel","input","getUserInput","Annotation","description","selection","styleSelection","empty","window","prompt","containerid","id","startIndex","getTotalOffset","anchorNode","anchorOffset","endIndex","focusNode","focusOffset","temp","getDepthRange","Math","max","updatedtextPanes","startInd","endInd","String","type","x","processAnnotation","push","validDepths","previous","d","anchor","escaped","offset","textContent","substring","replace","node","previousSibling","parentNode","new_annotation","prev_annotation","prev_start","prev_end","startHighlight","prev_len","endHighlight","slice","parseInt","prev_children","newPanes","keys","open","sidebarOpen","textbody","toggler","annotations","onMouseUp","sidebarContent","className","onClick","style","width","fontSize","height","placeholder","readOnly","Buffer","from","JSON","stringify","href","download","onChange","padding","sidebar","onSetOpen","styles","background","minHeight","onKeyUp","backgroundColor","visibility","class","bottom","right","a1","a2","a3","a4","encodedAnnotations","parse","regenerateAnnotations","regenerateTextPanes","click","regenerated","_depth","_start","_end","_description","_id","_color","ann_refs","React","Component","SummaryPage","isShowing","cur","MainPage","isExample","App","Boolean","location","hostname","match","ReactDOM","render","navigator","serviceWorker","ready","then","registration","unregister","AnnotationButton","isHighlighted","isEditing","handleDeleter","handleOnShow","handleOnClose","handleColorChange","handleHover","handleViewMode","handleViewModeReset","c","contains","stopPropagation","color_buttons","map","onMouseOver","lineHeight","paddingBottom","size","defaultValue","_groups","nodes","start","end","title","_title","desc","_selection"],"mappings":"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","file":"static/js/main.690129e5.chunk.js","sourcesContent":["import React from 'react';\r\nimport Sidebar from 'react-sidebar';\r\nimport { FaBars, FaTrash, FaChevronCircleDown, FaChevronCircleUp, FaCog, FaCogs, FaPaintBrush } from 'react-icons/fa';\r\n\r\nimport Annotation from './Annotation'\r\nimport AnnotationButton from './AnnotationButton'\r\nimport SummaryPage from './SummaryPage'\r\n\r\nconst colors = [\r\n\t\"#e88\", //red\r\n\t\"#ec5\", //orange\r\n\t\"#7a5\", //green\r\n\t\"#48f\", //blue\r\n\t\"#99e\", //violet\r\n\t\"#e9d\" //pink\r\n]\r\n\r\nexport default class MainText extends React.Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.state = {\r\n\t\t\tANNOTATIONS: [],\r\n\t\t\tannotation_id: 1,\r\n\t\t\tmaxDepth: 0,\r\n\t\t\tdefaultColorInd: 0,\r\n\t\t\ttext: \"\",\r\n\t\t\ttextPanes: [],\r\n\t\t\tisShowHelp: true,\r\n\t\t\tisShowImport: false, \r\n\t\t\tisShowImportAnnotations: false,\r\n\t\t\tisShowExportAnnotations: false,\r\n\t\t\tisShowSummary: false,\r\n\t\t\tisAutoEditMode: true\r\n\t\t};\r\n\r\n\t\tthis.handleAutoAnnotate = this.handleAutoAnnotate.bind(this);\r\n\t\tthis.handleAnnotate = this.handleAnnotate.bind(this);\r\n\t\tthis.handleRerender = this.handleRerender.bind(this);\r\n\t\tthis.handleAppend = this.handleAppend.bind(this);\r\n\t\tthis.handleAppendEnter = this.handleAppendEnter.bind(this);\r\n\t\tthis.handleClear = this.handleClear.bind(this);\r\n\t\tthis.handleDeleteAnnotation = this.handleDeleteAnnotation.bind(this);\r\n\t\tthis.handleDefaultColor = this.handleDefaultColor.bind(this);\r\n\r\n\t\tthis.onSetSidebarOpen = this.onSetSidebarOpen.bind(this);\r\n\t\tthis.handleExample = this.handleExample.bind(this);\r\n\t\tthis.handleShowImport = this.handleShowImport.bind(this);\r\n\t\tthis.handleImportAppend = this.handleImportAppend.bind(this);\r\n\t\tthis.handleImportReplace = this.handleImportReplace.bind(this);\r\n\t\tthis.handleShowHelp = this.handleShowHelp.bind(this);\r\n\t\r\n\t\tthis.handleShowExportAnnotations = this.handleShowExportAnnotations.bind(this);\r\n\t\tthis.handleShowImportAnnotations = this.handleShowImportAnnotations.bind(this);\r\n\t\tthis.handleImportAnnotations = this.handleImportAnnotations.bind(this);\r\n\t\tthis.handleImportFileAnnotations = this.handleImportFileAnnotations.bind(this);\r\n\t\tthis.handleStartFileUpload = this.handleStartFileUpload.bind(this);\r\n\t\tthis.handleSummarizeAnnotations = this.handleSummarizeAnnotations.bind(this);\r\n\t\tthis.handleEditMode = this.handleEditMode.bind(this);\r\n\t}\r\n\r\n\thandleEditMode() {\r\n\t\tthis.setState({ isAutoEditMode: !this.state.isAutoEditMode })\r\n\t}\r\n\r\n\thandleRerender(ann, color) { // update colors\r\n\t\tthis.reloadTextPanes(this.state.textPanes, ann, color);\r\n\t}\r\n\r\n\thandleDeleteAnnotation(ann) {\r\n\t\tvar index = -1;\r\n\t\tfor (var i = 0; i < this.state.textPanes.length; i++){\r\n\t\t\tif (this.state.textPanes[i].props && this.state.textPanes[i].props.annotation === ann.props.annotation) {\r\n\t\t\t\tindex = i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (index > -1) {\r\n\t\t\tthis.state.textPanes.splice.apply(this.state.textPanes, [index, 1].concat(ann.props.children));\r\n\t\t\tthis.setState(this.state)\r\n\t\t}\r\n\t}\r\n\r\n\treloadTextPanes(pane_list, ann, color) {\r\n\t\tfor (var i=0; i<pane_list.length; i++){\r\n\t\t\tif (pane_list[i].props && pane_list[i].props.children) {\r\n\t\t\t\t//reload children\r\n\t\t\t\tvar modified_children = pane_list[i].props.children;\r\n\t\t\t\tif (!Array.isArray(modified_children)){\r\n\t\t\t\t\tmodified_children = [modified_children];\r\n\t\t\t\t}\r\n\t\t\t\tthis.reloadTextPanes(modified_children, ann, color);\r\n\r\n\t\t\t\tpane_list[i] =\r\n\t\t\t\t\t<AnnotationButton\r\n\t\t\t\t\t\tupdater={ this.handleRerender }\r\n\t\t\t\t\t\tdeleter={ this.handleDeleteAnnotation }\r\n\t\t\t\t\t\tkey={ pane_list[i].key }\r\n\t\t\t\t\t\tdepth={ pane_list[i].props.depth }\r\n\t\t\t\t\t\tannotation={ pane_list[i].props.annotation }\r\n\t\t\t\t\t\tcolor={ pane_list[i].props.annotation===ann ? color : pane_list[i].props.annotation.color } >\r\n\t\t\t\t\t\t{ modified_children }\r\n\t\t\t\t\t</AnnotationButton>;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.setState(this.state);\r\n\t}\r\n\r\n\thandleAutoAnnotate(e) {\r\n\t\tif (this.state.isAutoEditMode) {\r\n\t\t\tthis.handleAnnotate(e);\r\n\t\t}\r\n\t}\r\n\r\n\thandleAnnotate(e) {\r\n\t\tif (document.getElementsByClassName(\"modal\").length){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (document.getSelection() && document.getSelection().toString().length>0) {    // all browsers, except IE before version 9\r\n\t\t\tvar sel = document.getSelection();\r\n        \tvar input = this.getUserInput();\r\n        \tif (!input){\r\n        \t\treturn\r\n        \t}\r\n        \tvar annotation = new Annotation();\r\n        \tannotation.description = input;\r\n        \tannotation.selection = sel.toString();\r\n        \tannotation.color = colors[this.state.defaultColorInd];\r\n        \tthis.styleSelection(sel, annotation, \"textbody\");\r\n        \tsel.empty();\r\n  \t\t}\r\n\t}\r\n\r\n\tgetUserInput() {\r\n\t\treturn window.prompt(\"What is this annotation for?\",\"\");\r\n\t}\r\n\r\n\tstyleSelection(sel, annotation, containerid) {\r\n\t\tannotation.id = this.state.annotation_id;\r\n\t\tannotation.startIndex = this.getTotalOffset(sel.anchorNode, sel.anchorOffset, containerid);\r\n\t\tannotation.endIndex = this.getTotalOffset(sel.focusNode, sel.focusOffset, containerid);\r\n\r\n\t\tif (annotation.startIndex > annotation.endIndex) {\r\n\t\t\tvar temp = annotation.startIndex;\r\n\t\t\tannotation.startIndex = annotation.endIndex;\r\n\t\t\tannotation.endIndex = temp;\r\n\t\t}\r\n\r\n\t\tvar depth = this.getDepthRange(annotation);\r\n\t\tannotation.depth = depth;\r\n\t\tthis.setState({ maxDepth: Math.max(this.state.maxDepth, depth) });\r\n\r\n\t\t//no modification necessary\r\n\t\tvar updatedtextPanes = []\r\n\t\tvar startInd = 0;\r\n\t\tvar endInd = this.state.text.length;\r\n\r\n\t\tfor (var i=0; i<this.state.textPanes.length; i++){\r\n\t\t\tif (typeof this.state.textPanes[i] === 'string' || this.state.textPanes[i] instanceof String) {\r\n\t\t\t\tendInd = startInd + this.state.textPanes[i].length;\r\n\t\t\t}\r\n\t\t\telse if (this.state.textPanes[i].type==='br') {\r\n\t\t\t\tendInd = startInd; //while it is treated as \\n in text, it doesn't count as a valid reduction of length\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tendInd = this.state.textPanes[i].props.annotation.endIndex;\r\n\t\t\t}\r\n\t\t\tvar x = this.processAnnotation(annotation, this.state.textPanes[i], startInd, endInd);\r\n\t\t\tupdatedtextPanes=updatedtextPanes.concat(x);\r\n\t\t\tstartInd = endInd;\r\n\t\t}\r\n\r\n\t\tthis.setState({textPanes: updatedtextPanes});\r\n\t\tthis.setState({annotation_id: this.state.annotation_id+1});\r\n\t\tthis.state.ANNOTATIONS.push(annotation);\r\n\t}\r\n\r\n\tgetDepthRange(annotation) {\r\n\t\tvar validDepths = [];\r\n\t\tfor (var i=0; i<this.state.maxDepth+1; i++){\r\n\t\t\tvalidDepths.push(i+1);\r\n\t\t}\r\n\t\tfor (var previous of this.state.ANNOTATIONS) {\r\n\t\t\tif (previous.startIndex < annotation.endIndex && annotation.startIndex < previous.endIndex) {\r\n\t\t\t\tvalidDepths[previous.depth - 1] = -1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (var d of validDepths){\r\n\t\t\tif (d>0) {\r\n\t\t\t\treturn d;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.state.maxDepth+1;\r\n\t}\r\n\r\n\tgetTotalOffset(anchor, anchorOffset, containerid) {\r\n\t\tvar escaped = /(\\t|\\r)+/;\r\n\t\tvar offset = anchorOffset - (anchor.textContent.substring(0,anchorOffset).length - anchor.textContent.substring(0,anchorOffset).replace(escaped,'').length);\r\n\t\tvar node = anchor;\r\n\t\twhile (node !== document.getElementById(containerid)) {\r\n\t\t\tif (node.previousSibling !== null) {\r\n\t\t\t\tnode = node.previousSibling;\r\n\t\t\t\toffset += node.textContent.replace(escaped,'').length;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnode = node.parentNode;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn offset;\r\n\t}\r\n\r\n\tprocessAnnotation(new_annotation, prev_annotation, prev_start, prev_end){\r\n\t\t//intersects\r\n\t\tif (new_annotation.startIndex < prev_end && prev_start < new_annotation.endIndex) {\r\n\r\n\t\t\t//Base case - String\r\n\r\n\t\t\tif (typeof prev_annotation === 'string' || prev_annotation instanceof String){\r\n\t\t\t\tvar startHighlight = new_annotation.startIndex > prev_start ? new_annotation.startIndex - prev_start : 0;\r\n\t\t\t\tvar prev_len = prev_end - prev_start;\r\n\t\t\t\tvar endHighlight = new_annotation.endIndex > prev_end ? prev_len : prev_len - (prev_end - new_annotation.endIndex);\r\n\r\n\t\t\t\tnew_annotation.color = colors[this.state.defaultColorInd];\r\n\r\n\t\t\t\treturn [prev_annotation.slice(0,startHighlight),\r\n\t\t\t\t\t\t<AnnotationButton\r\n\t\t\t\t\t\t\tupdater={ this.handleRerender }\r\n\t\t\t\t\t\t\tdeleter={ this.handleDeleteAnnotation }\r\n\t\t\t\t\t\t\tkey={ parseInt(\"\" + new_annotation.id + prev_start + prev_end) }\r\n\t\t\t\t\t\t\tdepth={ new_annotation.depth }\r\n\t\t\t\t\t\t\tannotation={ new_annotation }\r\n\t\t\t\t\t\t\tcolor={ new_annotation.color } >\r\n\t\t\t\t\t\t\t{prev_annotation.slice(startHighlight,endHighlight)}\r\n\t\t\t\t\t\t</AnnotationButton>,\r\n\t\t\t\t\t\tprev_annotation.slice(endHighlight)]\r\n\t\t\t}\r\n\t\t\telse if (prev_annotation.type==='br') {\r\n\t\t\t\treturn [<br key={ prev_annotation.key }></br>]\r\n\t\t\t}\r\n\r\n\t\t\t//Recurse\r\n\t\t\tvar prev_children = prev_annotation.props.children;\r\n\t\t\tif (!Array.isArray(prev_children)){\r\n\t\t\t\tprev_children = [prev_children];\r\n\t\t\t}\r\n\t\t\tvar modified_children = [];\r\n\t\t\tfor (var i=0; i<prev_children.length; i++){\r\n\t\t\t\tprev_end = (typeof prev_children[i] === 'string' || prev_children[i] instanceof String) ?\r\n\t\t\t\t\tprev_start + prev_children[i].length : prev_children[i].props.annotation.endIndex;\r\n\r\n\t\t\t\tmodified_children = modified_children.concat(this.processAnnotation(new_annotation, prev_children[i], prev_start, prev_end));\r\n\r\n\t\t\t\tprev_start = prev_end;\r\n\t\t\t}\r\n\r\n\t\t\treturn [<AnnotationButton\r\n\t\t\t\t\t\tupdater={ this.handleRerender }\r\n\t\t\t\t\t\tdeleter={ this.handleDeleteAnnotation }\r\n\t\t\t\t\t\tkey={ parseInt(\"\" + new_annotation.id + prev_start + prev_end) }\r\n\t\t\t\t\t\tdepth={ prev_annotation.props.depth }\r\n\t\t\t\t\t\tannotation={ prev_annotation.props.annotation }\r\n\t\t\t\t\t\tcolor={ prev_annotation.props.annotation.color }>\r\n\t\t\t\t\t\t{ modified_children }\r\n\t\t\t\t\t</AnnotationButton>];\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn prev_annotation;\r\n\t\t}\r\n\t}\r\n\r\n\thandleAppend() {\r\n\t\tvar newPanes = this.state.textPanes;\r\n\t\tnewPanes.push(\"\" + document.getElementById(\"append-text\").value);\r\n\t\tnewPanes.push(<br key={ parseInt(\"\" + -1 + this.state.text.length + this.state.text.length) }></br>);\r\n\t\tthis.setState({ textPanes : newPanes, text : this.state.text + \"\\n\" + document.getElementById(\"append-text\").value})\r\n\t\tdocument.getElementById(\"append-text\").value = \"\";\r\n\t}\r\n\r\n\thandleAppendEnter(e) {\r\n\t\tif (e.key === \"Enter\") {\r\n\t\t\tthis.handleAppend();\r\n\t\t}\r\n\t}\r\n\r\n\thandleDefaultColor() {\r\n\t\tthis.setState({ defaultColorInd: (this.state.defaultColorInd + 1) % colors.length })\r\n\t}\r\n\r\n\thandleImportReplace() {\r\n\t\tvar newPanes = [];\r\n\t\tnewPanes.push(\"\" + document.getElementById(\"import-text\").value);\r\n\t\tnewPanes.push(<br key={ parseInt(\"\" + -1 + this.state.text.length + this.state.text.length) }></br>);\r\n\t\tthis.setState({\r\n\t\t\tANNOTATIONS: [],\r\n\t\t\tannotation_id: 1,\r\n\t\t\tmaxDepth: 0,\r\n\t\t\ttext: \"\",\r\n\t\t\ttextPanes: newPanes\r\n\t\t});\r\n\t\tdocument.getElementById(\"import-text\").value = \"\";\r\n\t}\r\n\t\r\n\thandleImportAppend() {\r\n\t\tvar newPanes = this.state.textPanes;\r\n\t\tnewPanes.push(\"\" + document.getElementById(\"import-text\").value);\r\n\t\tnewPanes.push(<br key={ parseInt(\"\" + -1 + this.state.text.length + this.state.text.length) }></br>);\r\n\t\tthis.setState({ textPanes : newPanes, text : this.state.text + \"\\n\" + document.getElementById(\"import-text\").value})\r\n\t\tdocument.getElementById(\"import-text\").value = \"\";\r\n\t}\r\n\r\n\thandleClear() {\r\n\t\tthis.setState({\r\n\t\t\t\tANNOTATIONS: [],\r\n\t\t\t\tannotation_id: 1,\r\n\t\t\t\tkeys: 1,\r\n\t\t\t\tmaxDepth: 0,\r\n\t\t\t\ttext: \"\",\r\n\t\t\t\ttextPanes: []\r\n\t\t\t});\r\n\t}\r\n\r\n\tonSetSidebarOpen(open) {\r\n\t\tthis.setState({ sidebarOpen: open })\r\n\t}\r\n\r\n\trender() {\r\n\t\tvar textbody = (\r\n\t\t\t<div>\r\n\t\t\t\t{ this.state.isShowSummary && \r\n\t\t\t\t\t<SummaryPage toggler={ this.handleSummarizeAnnotations } annotations={this.state.ANNOTATIONS}></SummaryPage> }\r\n\t\t\t\t<div id=\"textbody\" onMouseUp={this.handleAutoAnnotate}>\r\n\t\t\t\t\t{ this.state.textPanes }\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\r\n\t\tvar sidebarContent =\r\n\t\t\t<div className=\"sideNav\">\r\n\t\t\t\t<p className=\"menuItem\"  onClick={ this.handleExample }> Example </p>\r\n\t\t\t\t<p className=\"menuItem\"  onClick={ this.handleSummarizeAnnotations }> Annotations </p>\r\n\t\t\t\t<p className=\"menuItem\"  onClick={ this.handleShowImport }> Bulk Plaintext { this.state.isShowImport ? <FaChevronCircleUp/> : <FaChevronCircleDown/> }</p>\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.state.isShowImport &&\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<textarea id=\"import-text\" style={ {width:\"100%\", fontSize: \"0.75em\", height:\"12em\"} } placeholder=\"Enter text to input.\">\r\n\t\t\t\t\t\t</textarea>\r\n\t\t\t\t\t\t<button style={ {width:\"50%\", fontSize: \"0.75em\"} } onClick={this.handleImportReplace} type=\"button\">Replace</button>\r\n\t\t\t\t\t\t<button style={ {width:\"50%\", fontSize: \"0.75em\"} } onClick={this.handleImportAppend} type=\"button\">Append</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t<p className=\"menuItem\"  onClick={ this.handleShowExportAnnotations }> Export Annotations { this.state.isShowExportAnnotations ? <FaChevronCircleUp/> : <FaChevronCircleDown/> }</p>\r\n\t\t\t\t{\r\n\t\t\t\t\t this.state.isShowExportAnnotations &&\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<textarea id=\"export-annotations\" style={ {width:\"100%\", fontSize: \"0.75em\", height:\"12em\"} } readOnly value={ Buffer.from(JSON.stringify(this.state)).toString(\"base64\") }>\r\n\t\t\t\t\t\t</textarea>\r\n\t\t\t\t\t\t<a href={ 'data:text/plain;charset=utf-8,' + Buffer.from(JSON.stringify(this.state)).toString(\"base64\") } download={ \"LangAnnotator.txt\" }>\r\n\t\t\t\t\t\t\t<button style={ {width:\"100%\", fontSize: \"0.75em\"} } type=\"button\">Save as File</button>\r\n\t\t\t\t\t\t</a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t<p className=\"menuItem\"  onClick={ this.handleShowImportAnnotations }> Import Annotations { this.state.isShowImportAnnotations ? <FaChevronCircleUp/> : <FaChevronCircleDown/> } </p>\r\n\t\t\t\t{\r\n\t\t\t\t\t this.state.isShowImportAnnotations &&\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<textarea id=\"import-annotations\" style={ {width:\"100%\", fontSize: \"0.75em\", height:\"12em\"} }>\r\n\t\t\t\t\t\t</textarea>\r\n\t\t\t\t\t\t<button style={ {width:\"50%\", fontSize: \"0.75em\"} } onClick={this.handleImportAnnotations} type=\"button\">Load</button>\r\n\t\t\t\t\t\t<button style={ {width:\"50%\", fontSize: \"0.75em\"} } onClick={this.handleStartFileUpload} type=\"button\">File Import</button>\r\n\t\t\t\t\t\t<input type=\"file\" id=\"annotationFileInput\" className=\"annotationImport\" onChange={(e) => this.handleImportFileAnnotations(e)} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t<p className=\"menuItem\"  onClick={ this.handleShowHelp }> Help { this.state.isShowHelp ? <FaChevronCircleUp/> : <FaChevronCircleDown/> }</p>\r\n\t\t\t\t{ \r\n\t\t\t\t\tthis.state.isShowHelp &&\r\n\t\t\t\t\t<div style={{fontSize: \"0.75em\", padding: \"0 0.25em\"}}>\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\t<b>Highlight</b> a part of the text to add an annotation.\r\n\t\t\t\t\t</p>\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\t<b>Click</b> an annotation to view it or modify it.\r\n\t\t\t\t\t</p>\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\tUse the top <b>Append</b> bar to add another line to the main text body. Use the <b>Import Plaintext</b> option to append large blocks of text.\r\n\t\t\t\t\t</p>\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\tClick on the <b>trash can</b> to clear the body of text.\r\n\t\t\t\t\t</p>\r\n\t\t\t\t\t<p> \r\n\t\t\t\t\t\tSave the state of your notebook from <b>Export Annotations</b> and reload it using <b>Import Annotations</b>.\r\n\t\t\t\t\t</p>\r\n\t\t\t\t</div>}\r\n\t\t\t</div>\r\n\r\n\t    return (\r\n\t    \t\t<Sidebar sidebar={ sidebarContent }\r\n\t\t\t        \topen={this.state.sidebarOpen}\r\n\t\t\t        \tonSetOpen={this.onSetSidebarOpen}\r\n\t\t\t        \tstyles={{ sidebar: { background: \"white\", width: \"25%\" } }}>\r\n     \t\t\t\t<div className=\"topNav\">\r\n\t     \t\t\t\t<div className=\"menuBar\">\r\n\t\t     \t\t\t\t<button style={{ minHeight: \"2em\" }} onClick={() => this.onSetSidebarOpen(true)}>\r\n\t    \t     \t\t\t\t<FaBars/>\r\n\t        \t\t\t\t</button>\r\n\t        \t\t\t\t<span>\r\n\t        \t\t\t\t\tLangAnnotator\r\n\t        \t\t\t\t</span>\r\n\t\t\t    \t\t</div>\r\n\t\t\t\t\t\t<div className=\"nav-append\">\r\n\t\t\t\t\t\t\t<input type=\"text\" id=\"append-text\" onKeyUp={ this.handleAppendEnter }></input>\r\n\t\t\t\t\t\t\t<span className=\"dot-bg\">\r\n\t\t\t\t\t\t\t\t<span className=\"dot\" style={{ backgroundColor: colors[this.state.defaultColorInd] }} onClick={this.handleDefaultColor}></span>\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t<button onClick={this.handleAppend} type=\"button\">Append</button>\r\n\t\t\t\t\t\t\t<button onClick={this.handleClear} type=\"button\"><FaTrash/></button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div style={{ visibility: \"hidden\" }}>\r\n\t     \t\t\t\t<div className=\"menuBar\">\r\n\t\t     \t\t\t\t<button style={{ minHeight: \"2em\" }} onClick={() => this.onSetSidebarOpen(true)}>\r\n\t    \t     \t\t\t\t<FaBars/>\r\n\t        \t\t\t\t</button>\r\n\t        \t\t\t\t<span>\r\n\t        \t\t\t\t\tLangAnnotator\r\n\t        \t\t\t\t</span>\r\n\t\t\t    \t\t</div>\r\n\t\t\t\t\t\t<div className=\"nav-append\">\r\n\t\t\t\t\t\t\t<input type=\"text\" id=\"append-teaxt\" onKeyUp={ this.handleAppendEnter }></input>\r\n\t\t\t\t\t\t\t<button onClick={this.handleAppend} type=\"button\">Append</button>\r\n\t\t\t\t\t\t\t<button onClick={this.handleClear} type=\"button\"><FaTrash/></button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t    \t\t{ textbody }\r\n\t\t    \t\t{ this.state.isAutoEditMode ?\r\n\t\t\t\t\t\t<a href=\"#\" class=\"float-option\" onClick={ this.handleEditMode } style={{bottom:\"40px\", right:\"40px\"}} >\r\n\t\t\t\t\t\t\t<div class=\"float-option-icon\">\r\n\t\t\t\t\t\t\t\t<FaCog/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</a> :\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<a href=\"#\" class=\"float-option\" onClick={ this.handleAnnotate } style={{bottom:\"120px\", right:\"40px\"}} >\r\n\t\t\t\t\t\t\t<div class=\"float-option-icon\">\r\n\t\t\t\t\t\t\t\t<FaPaintBrush/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t<a href=\"#\" class=\"float-option\" onClick={ this.handleEditMode } style={{ bottom:\"40px\", right:\"40px\"}} >\r\n\t\t\t\t\t\t\t<div class=\"float-option-icon\">\r\n\t\t\t\t\t\t\t\t<FaCogs/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t    \t\t</Sidebar>\r\n\t    \t);\r\n\t}\r\n\r\n\thandleExample() {\r\n\t\tvar a1 = new Annotation(1, 18, 26, \"cambiar - verb\\nto change\", \"cambiar\");\r\n\t\ta1.id = 1;\r\n\t\ta1.color = colors[1];\r\n\t\tvar a2 = new Annotation(1, 42, 46, \"emos/amos indicates that the pronoun is \\\"us\\\"\", \"emos\");\r\n\t\ta2.id = 2;\r\n\t\ta2.color = colors[0];\r\n\t\tvar a3 = new Annotation(1, 99, 105, \"cambiar\", \"change\");\r\n\t\ta3.id = 3;\r\n\t\ta3.color = colors[1];\r\n\t\tvar a4 = new Annotation(1, 146, 162, \"Guatemalan activist and Nobel Peace prize winner\", \"Rigoberta Menchu\");\r\n\t\ta4.id = 4;\r\n\t\ta4.color = colors[3];\r\n\r\n\t\tthis.setState({\r\n\t\t\tANNOTATIONS: [a1, a2, a3, a4],\r\n\t\t\tannotation_id: 5,\r\n\t\t\tmaxDepth: 1,\r\n\t\t\ttext: \"Este mundo no va a cambiar a menos que estemos dispuestos a cambiar nosotros mismos\\nThe world won't change unless we're willing to change ourselves\\nRigoberta Menchu\",\r\n\t\t\ttextPanes:\r\n\t\t\t\t[\"Este mundo no va a \",\r\n\t\t\t\t<AnnotationButton\r\n\t\t\t\t\t\tupdater={ this.handleRerender }\r\n\t\t\t\t\t\tdeleter={ this.handleDeleteAnnotation }\r\n\t\t\t\t\t\tkey={ parseInt(\"\" + a1.id + a1.startIndex + a1.endIndex) }\r\n\t\t\t\t\t\tdepth={ a1.depth }\r\n\t\t\t\t\t\tannotation={ a1 }\r\n\t\t\t\t\t\tcolor={ a1.color }>\r\n\t\t\t\t\t\tcambiar\r\n\t\t\t\t\t</AnnotationButton>,\r\n\t\t\t\t\" a menos que est\",\r\n\t\t\t\t<AnnotationButton\r\n\t\t\t\t\t\tupdater={ this.handleRerender }\r\n\t\t\t\t\t\tdeleter={ this.handleDeleteAnnotation }\r\n\t\t\t\t\t\tkey={ parseInt(\"\" + a2.id + a2.startIndex + a2.endIndex) }\r\n\t\t\t\t\t\tdepth={ a2.depth }\r\n\t\t\t\t\t\tannotation={ a2 }\r\n\t\t\t\t\t\tcolor={ a2.color }>\r\n\t\t\t\t\t\temos\r\n\t\t\t\t\t</AnnotationButton>,\r\n\t\t\t\t\" dispuestos a cambiar nosotros mismos\",\r\n\t\t\t\t<br key={1}></br>,\r\n\t\t\t\t\"The world won't \",\r\n\t\t\t\t<AnnotationButton\r\n\t\t\t\t\t\tupdater={ this.handleRerender }\r\n\t\t\t\t\t\tdeleter={ this.handleDeleteAnnotation }\r\n\t\t\t\t\t\tkey={ parseInt(\"\" + a3.id + a3.startIndex + a3.endIndex) }\r\n\t\t\t\t\t\tdepth={ a3.depth }\r\n\t\t\t\t\t\tannotation={ a3 }\r\n\t\t\t\t\t\tcolor={ a3.color }>\r\n\t\t\t\t\t\tchange\r\n\t\t\t\t\t</AnnotationButton>,\r\n\t\t\t\t \" unless we're willing to change ourselves\",\r\n\t\t\t\t <br key={2}></br>,\r\n\t\t\t\t \"\",\r\n\t\t\t\t <AnnotationButton\r\n\t\t\t\t\t\tupdater={ this.handleRerender }\r\n\t\t\t\t\t\tdeleter={ this.handleDeleteAnnotation }\r\n\t\t\t\t\t\tkey={ parseInt(\"\" + a4.id + a4.startIndex + a4.endIndex) }\r\n\t\t\t\t\t\tdepth={ a4.depth }\r\n\t\t\t\t\t\tannotation={ a4 }\r\n\t\t\t\t\t\tcolor={ a4.color }>\r\n\t\t\t\t\t\tRigoberta Menchu\r\n\t\t\t\t\t</AnnotationButton>,\r\n\t\t\t\t \"\",\r\n\t\t\t\t <br key={3}></br>]\r\n\t\t});\r\n\t\tthis.setState();\r\n\t}\r\n\r\n\thandleShowHelp() {\r\n\t\tthis.setState({ isShowHelp: !this.state.isShowHelp });\r\n\t}\r\n\r\n\thandleShowImport() {\r\n\t\tthis.setState({ isShowImport: !this.state.isShowImport });\r\n\t}\r\n\r\n\thandleShowImportAnnotations() {\r\n\t\tthis.setState({ isShowImportAnnotations: !this.state.isShowImportAnnotations });\r\n\t}\r\n\r\n\thandleShowExportAnnotations() {\r\n\t\tthis.setState({ isShowExportAnnotations: !this.state.isShowExportAnnotations });\r\n\t}\r\n\r\n\thandleImportAnnotations() {\r\n\t\tlet encodedAnnotations = document.getElementById(\"import-annotations\").value;\r\n\t\tvar annotations = JSON.parse(Buffer.from(encodedAnnotations, \"base64\").toString(\"utf-8\"));\r\n\t\tannotations.ANNOTATIONS = this.regenerateAnnotations(annotations.ANNOTATIONS);\r\n\t\tannotations.textPanes = this.regenerateTextPanes(annotations.textPanes, annotations.ANNOTATIONS);\r\n\t\tthis.setState(annotations);\r\n\t}\r\n\r\n\thandleImportFileAnnotations = async (e) => {\r\n\t\te.preventDefault()\r\n\t\tconst reader = new FileReader()\r\n\t\treader.onload = async (e) => { \r\n\t    \tconst text = (e.target.result);\r\n\t    \tdocument.getElementById(\"import-annotations\").value = text;\r\n\t    };\r\n\t    reader.readAsText(e.target.files[0]);\r\n\t}\r\n\r\n\thandleStartFileUpload() {\r\n\t\tdocument.getElementById(\"annotationFileInput\").click();\r\n\t}\r\n\r\n\thandleSummarizeAnnotations() {\r\n\t\tthis.setState({isShowSummary: !this.state.isShowSummary});\r\n\t}\r\n\r\n\tregenerateAnnotations(annotations) {\r\n\t\tvar regenerated = []\r\n\t\tvar temp;\r\n\t\tfor (var i=0; i<annotations.length; i++){\r\n\t\t\ttemp = new Annotation(annotations[i]._depth, annotations[i]._start, annotations[i]._end, annotations[i]._description);\r\n\t\t\ttemp.id = annotations[i]._id; \r\n\t\t\ttemp.color = annotations[i]._color;\r\n\t\t\tregenerated.push(temp)\r\n\t\t}\r\n\t\treturn regenerated;\r\n\t}\r\n\r\n\tregenerateTextPanes(annotations, ann_refs) {\r\n\t\tvar regenerated = [];\r\n\t\tfor (var i=0; i<annotations.length; i++){\r\n\t\t\tif (typeof annotations[i] === 'string' || annotations[i] instanceof String) {\r\n\t\t\t\tregenerated.push(annotations[i]);\r\n\t\t\t}\r\n\t\t\telse if (annotations[i].type === \"br\") {\r\n\t\t\t\tregenerated.push(<br key={ annotations[i].key }></br>);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tregenerated.push(\r\n\t\t\t\t\t<AnnotationButton\r\n\t\t\t\t\t\tupdater={ this.handleRerender }\r\n\t\t\t\t\t\tdeleter={ this.handleDeleteAnnotation }\r\n\t\t\t\t\t\tkey={ annotations[i].key }\r\n\t\t\t\t\t\tdepth={ annotations[i].props.depth }\r\n\t\t\t\t\t\tannotation={ ann_refs[annotations[i].props.annotation._id - 1] }\r\n\t\t\t\t\t\tcolor={ annotations[i].props.annotation.color }>\r\n\t\t\t\t\t\t{ Array.isArray(annotations[i].props.children) ? \r\n\t\t\t\t\t\t\tthis.regenerateTextPanes(annotations[i].props.children, ann_refs) :\r\n\t\t\t\t\t\t\tthis.regenerateTextPanes([annotations[i].props.children], ann_refs)[0] }\r\n\t\t\t\t\t</AnnotationButton>);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn regenerated;\r\n\t}\r\n}","import React from 'react';\n\nimport AnnotationButton from './AnnotationButton'\n\nexport default class SummaryPage extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tisShowing: true\n\t\t}\n\t}\n\n\trender() {\n\t\tlet annotations = []\n\t\tfor (var i=0; i < this.props.annotations.length; i++){\n\t\t\tlet cur = this.props.annotations[i];\n\t\t\tannotations.push(\n\t\t\t\t<span key={ cur.id }> \n\t\t\t\t\t<span style={{color: cur.color}}>{cur.selection}</span> - { cur.description } \n\t\t\t\t</span>);\n\t\t}\n\t\treturn (<div>\n\t\t\t{ this.state.isShowing && (<div className=\"modal-bg\" onClick={ this.props.toggler } style={ {color: \"black\"} }>\n\t\t\t<div id=\"summary-modal\" className=\"modal\">\n\t\t\t\t<div className=\"modal-inner\">\n\t\t\t\t\t<div className=\"modal-header\"></div>\n\t\t\t\t\t<hr></hr>\n\t\t\t\t\t{ annotations }\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>) }\n\t\t</div>);\n\t}\n}","import React from 'react';\r\n\r\nimport MainText from './MainText';\r\n\r\nexport default class MainPage extends React.Component {\r\n\t\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\t\r\n\t\tthis.state = {\r\n\t\t\tisExample: true,\r\n\t\t\tsidebarOpen: false\r\n\t\t};\r\n\t\tthis.onSetSidebarOpen = this.onSetSidebarOpen.bind(this);\r\n\t\tthis.handleExample = this.handleExample.bind(this);\r\n\t}\r\n\r\n\tonSetSidebarOpen(open) {\r\n\t\tthis.setState({ sidebarOpen: open })\r\n\t}\r\n\r\n\thandleExample() {\r\n\t\tthis.setState({ isExample: true });\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn <MainText></MainText>;\r\n\t\t/*\r\n\t    return (\r\n\t    \t<div>\r\n\t    \t\t<Sidebar sidebar={ sidebarContent }\r\n\t\t\t        \topen={this.state.sidebarOpen}\r\n\t\t\t        \tonSetOpen={this.onSetSidebarOpen}\r\n\t\t\t        \tstyles={{ sidebar: { background: \"white\", width: \"10em\"} }}>\r\n     \t\t\t\t\r\n     \t\t\t\t<div className=\"menuBar\">\t\r\n\t     \t\t\t\t<button style={{ minHeight: \"2em\" }} onClick={() => this.onSetSidebarOpen(true)}>\r\n    \t     \t\t\t\t<FaBars/>\r\n        \t\t\t\t</button>\r\n        \t\t\t\t<span>\r\n        \t\t\t\t\tLangAAnnotator\r\n        \t\t\t\t</span>\r\n\t\t    \t\t</div>\r\n\r\n\t\t    \t\t<MainText runExample={ this.state.isExample }></MainText>\r\n\r\n\t    \t\t</Sidebar>\r\n\t    \t</div>);\r\n\t    */\r\n\t}\r\n}","import React from 'react';\n//import logo from './logo.svg';\n\nimport MainPage from './components/MainPage';\n\nimport './App.css';\nimport './components/TextBody.css';\n\nfunction App() {\n  return (\n    <MainPage></MainPage>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","import React from 'react';\r\nimport { FaPen, FaTrash } from 'react-icons/fa'\r\n\r\nimport './Annotation.css'\r\nimport './TextBody.css'\r\n\r\nconst colors = [\r\n\t\"#e88\", //red\r\n\t\"#ec5\", //orange\r\n\t\"#7a5\", //green\r\n\t\"#48f\", //blue\r\n\t\"#99e\", //violet\r\n\t\"#e9d\" //pink\r\n]\r\n\r\nexport default class AnnotationButton extends React.Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tisShowing: false,\r\n\t\t\tisHighlighted: false,\r\n\t\t\tcolor: this.props.color,\r\n\t\t\tisEditing: false\r\n\t\t}\r\n\t\tthis.handleDeleter = this.handleDeleter.bind(this);\r\n\t\tthis.handleOnShow = this.handleOnShow.bind(this);\r\n\t\tthis.handleOnClose = this.handleOnClose.bind(this);\r\n\t\tthis.handleColorChange = this.handleColorChange.bind(this);\r\n\t\tthis.handleHover = this.handleHover.bind(this);\r\n\t\tthis.handleEditMode = this.handleEditMode.bind(this);\r\n\t\tthis.handleViewMode = this.handleViewMode.bind(this);\r\n\t\tthis.handleViewModeReset = this.handleViewModeReset.bind(this);\r\n\t}\r\n\r\n\thandleHover() {\r\n\t}\r\n\r\n\thandleDeleter() {\r\n\t\tthis.props.deleter(this)\r\n\t}\r\n\r\n\thandleColorChange(c) {\r\n\t\tthis.setState({color: c});\r\n\t\tthis.props.annotation.color = c;\r\n\t\tthis.props.updater(this.props.annotation, c);\r\n\t}\r\n\r\n\thandleOnShow() {\r\n\t\tif (!this.state.isShowing){\r\n\t\t\tthis.setState({ isShowing: true });\r\n\t\t}\r\n\t}\r\n\r\n\thandleOnClose(e) {\r\n\t\tif (document.getElementsByClassName(\"modal\").length && \r\n\t\t\t!document.getElementsByClassName(\"modal\")[0].contains(e.target)){\r\n\t\t\tthis.setState({ isShowing: false });\r\n\t\t}\r\n\t\te.stopPropagation();\r\n\t}\r\n\r\n\thandleEditMode() {\r\n\t\tthis.setState({ isEditing : !this.state.isEditing });\r\n\t}\r\n\r\n\thandleViewMode() {\r\n\t\tthis.props.annotation.description = document.getElementById(\"updatedDescription\").value;\r\n\t\tthis.setState({ isEditing : !this.state.isEditing });\r\n\t}\r\n\r\n\thandleViewModeReset() {\r\n\t\tdocument.getElementById(\"updatedDescription\").value = this.props.annotation.description;\r\n\t\tthis.setState({ isEditing : !this.state.isEditing });\r\n\t}\r\n\r\n\trender() {\r\n\t\tlet color_buttons = colors.map((c) => <span onClick={ () => this.handleColorChange(c) } \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"color-selector\" \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={c} \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle={{backgroundColor: c}}></span>)\r\n\t\treturn (\r\n\t\t\t<span>\r\n\t\t\t\t<span className={ this.state.isHighlighted ? \"annotation-btn\" : \"annotation-btn\"} \r\n\t\t\t\t\tonMouseOver={ this.handleHover }\r\n\t\t\t\t\tonClick={ this.handleOnShow }\r\n\t\t\t\t\tstyle={ {background: `linear-gradient(0deg, ${this.props.annotation.color}, white 1px, transparent 1px)`,\r\n\t\t\t\t\t\t\tlineHeight: `${20+(this.props.depth-1)}px`,\r\n\t\t\t\t\t\t\tpaddingBottom: `${4*(this.props.depth-1)}px`,\r\n\t\t\t\t\t\t\tcolor: this.props.annotation.color} }>\r\n\t\t\t\t{ this.props.children }\r\n\t\t\t\t</span>\r\n\t\t\t\t{ \r\n\t\t\t\t\tthis.state.isShowing && \r\n\t\t\t\t\t<div className=\"modal-bg\" onClick={ this.handleOnClose } style={ {color: \"black\"} }>\r\n\t\t\t\t\t\t<div className=\"modal\">\r\n\t\t\t\t\t\t<div className=\"modal-inner\">\r\n\t\t\t\t\t\t\t<div className=\"modal-header\">\r\n\t\t\t\t\t\t\t\t{ color_buttons }\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<hr></hr>\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t!this.state.isEditing &&\r\n\t\t\t\t\t\t\t\t<div className=\"modal-desc\">\r\n\t\t\t\t\t\t\t\t\t<span className=\"modal-desc-text\">\r\n\t\t\t\t\t\t\t\t\t\t{ this.props.annotation.description }\r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t<br></br>\r\n\t\t\t\t\t\t\t\t\t<div className=\"optionsBar\">\r\n\t\t\t\t\t\t\t\t\t<span className=\"lowOptions\" onClick={ this.handleEditMode } size={5}>\r\n\t\t\t\t\t\t\t\t\t\t<FaPen/>\r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t<span className=\"lowOptions\" onClick={ this.handleDeleter } size={5}>\r\n\t\t\t\t\t\t\t\t\t\t<FaTrash/>\r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\t\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tthis.state.isEditing &&\r\n\t\t\t\t\t\t\t\t<div className=\"modal-desc\">\r\n\t\t\t\t\t\t\t\t\t<textarea id=\"updatedDescription\" defaultValue={ this.props.annotation.description }></textarea>\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<button class=\"modal-submit\" type=\"button\" onClick={ this.handleViewMode }>Update Description</button>\r\n\t\t\t\t\t\t\t\t\t<button class=\"modal-reset\" type=\"button\" onClick={ this.handleViewModeReset }>Cancel</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</span>\r\n\t\t);\r\n\t}\r\n}","export default class Annotation {\r\n\tconstructor(depth=1, startIndex=0, endIndex=0, description=\"\", selection=\"\") {\r\n\t\tthis._groups = [];\r\n\t\tthis.depth = depth;;\r\n\t\tthis.startIndex = startIndex;\r\n\t\tthis.endIndex = endIndex;\r\n\t\tthis.description = description;\r\n\t\tthis.selection = selection;\r\n\t}\r\n\t//MUTATORS\r\n\tset id(id) {\r\n\t\tthis._id = id;\r\n\t}\r\n\tset groups(nodes) {\r\n\t\tthis._groups = nodes;\r\n\t}\r\n\tset startIndex(start) {\r\n\t\tthis._start = start;\r\n\t}\r\n\tset endIndex(end) {\r\n\t\tthis._end = end;\r\n\t}\r\n\tset depth(depth) {\r\n\t\tthis._depth = depth;\r\n\t}\r\n\tset title(title) {\r\n\t\tthis._title = title;\r\n\t}\r\n\tset description(desc) {\r\n\t\tthis._description = desc;\r\n\t}\r\n\tset selection(sel) {\r\n\t\tthis._selection = sel;\r\n\t}\r\n\tset color(color) {\r\n\t\tthis._color = color;\r\n\t}\r\n\t// ACCESSORS\r\n\tget id() {\r\n\t\treturn this._id;\r\n\t}\r\n\tget groups() {\r\n\t\treturn this._groups;\r\n\t}\r\n\tget startIndex() {\r\n\t\treturn this._start;\r\n\t}\r\n\tget endIndex() {\r\n\t\treturn this._end;\r\n\t}\r\n\tget depth() {\r\n\t\treturn this._depth;\r\n\t}\r\n\tget title() {\r\n\t\treturn this._title;\r\n\t}\r\n\tget description() {\r\n\t\treturn this._description;\r\n\t}\r\n\tget selection() {\r\n\t\treturn this._selection;\r\n\t}\r\n\tget color() {\r\n\t\treturn this._color;\r\n\t}\r\n}"],"sourceRoot":""}